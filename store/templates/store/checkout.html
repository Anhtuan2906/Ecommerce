{% extends 'store/main.html' %}
{% load static %}
{% block content %}
    <div class="row">
        {% for product in products %}
        <div class="col-lg-4">
            <img class="thumbnail" src="{{ product.imageURL }}">
            <div class="box-element product" data-product="{{ product.id }}">
                <h6><strong>{{ product.name }}</strong></h6>
                <hr>

                <button data-action="add" class="btn btn-outline-secondary add-btn update-cart">Add to Cart</button>
                
                <a class="btn btn-outline-success view-product" href="#" data-product="{{ product.id }}">View</a>
                <h4 style="display: inline-block; float: right"><strong>${{ product.price }}</strong></h4>

                <!-- Display click count -->
                <p>Clicks: <span class="click-count">{{ product.click_count }}</span></p>
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        // Function to handle product click count increment
        function incrementClickCount(productId) {
            fetch(`/click_product/${productId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    // Update click count in the UI
                    const clickCountElement = document.querySelector(`[data-product="${productId}"] .click-count`);
                    const currentCount = parseInt(clickCountElement.textContent);
                    clickCountElement.textContent = currentCount + 1;
                }
            });
        }

        // Attach click event listeners to product view buttons
        document.addEventListener('DOMContentLoaded', () => {
            const viewButtons = document.querySelectorAll('.view-product');
            viewButtons.forEach(button => {
                const productId = button.getAttribute('data-product');
                button.addEventListener('click', (event) => {
                    event.preventDefault();
                    incrementClickCount(productId);
                    // You can add further logic here to handle viewing the product details
                });
            });
        });
    </script>
{% endblock content %}
